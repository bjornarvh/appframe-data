(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b():"function"==typeof define&&define.amd?define(b):a.DataObject=b()})(this,function(){"use strict";function a(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function b(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function c(a,c,d){return c&&b(a.prototype,c),d&&b(a,d),a}function d(a){if("function"==typeof a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];a.apply(void 0,c)}}var e=/*#__PURE__*/function(){function b(c){a(this,b);var d=c.articleId,e=c.dataSourceId,f=c.fields,g=c.groupBy,h=c.timeout;d?this.articleId=d:window.af&&window.af.article&&(this.articleId=window.af.article.id),this.dataSourceId=e||null,this.fields=f||null,this.groupBy=g||null,this.timeout=h||3e4}return c(b,[{key:"create",value:function(a,b){return this.request("create",a,b)}},{key:"destroy",value:function(a,b){return this.request("destroy",a,b)}},{key:"retrieve",value:function(a,b){return this.request("retrieve",a,b)}},{key:"update",value:function(a,b){return this.request("update",a,b)}},{key:"request",value:function(a,b,c){var e=this;return new Promise(function(f,g){var h={body:JSON.stringify(b),method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"}},i=null,j="/".concat(a,"/").concat(e.articleId,"/").concat(e.dataSourceId),k=!1;e.fields&&(j+="/".concat(e.fields instanceof Array?e.fields.join("-"):e.fields)),e.groupBy&&(j+="/"+e.groupBy),window.AbortController&&(e.previousRequestController&&e.previousRequestController.abort(),i=new window.AbortController,e.previousRequestController=i,h.signal=e.previousRequestController.signal);var l=setTimeout(function(){i&&i.abort(),k=!0,f(!1)},e.timeout);fetch(j,h).then(function(a){return clearTimeout(l),!(k||i&&e.previousRequestController!==i)&&a.json()}).then(function(a){!1===a?f(!1):a.hasOwnProperty("success")?(d(c,null,a.success),f(a.success)):a.hasOwnProperty("error")&&(d(c,null,a.error),g(a.error))}).catch(function(a){"Aborted"===a.message||window.AbortError&&a instanceof window.AbortError?f(!1):g(a)})})}}]),b}();return e});
