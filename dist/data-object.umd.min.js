(function(a,b){"object"==typeof exports&&"undefined"!=typeof module?module.exports=b(require("eventemitter3")):"function"==typeof define&&define.amd?define(["eventemitter3"],b):a.DataObject=b(a.EventEmitter)})(this,function(a){"use strict";function b(a){return b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},b(a)}function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function d(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function e(a,b,c){return b&&d(a.prototype,b),c&&d(a,c),a}function f(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function");a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,writable:!0,configurable:!0}}),b&&i(a,b)}function h(a){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},h(a)}function i(a,b){return i=Object.setPrototypeOf||function(a,b){return a.__proto__=b,a},i(a,b)}function j(a){if(void 0===a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return a}function k(a,b){return b&&("object"==typeof b||"function"==typeof b)?b:j(a)}function l(a,b){for(;!Object.prototype.hasOwnProperty.call(a,b)&&(a=h(a),null!==a););return a}function m(a,b,c){return m="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(a,b,c){var d=l(a,b);if(d){var e=Object.getOwnPropertyDescriptor(d,b);return e.get?e.get.call(c):e.value}},m(a,b,c||a)}function n(a,b){if(!b.has(a))throw new TypeError("attempted to get private field on non-instance");return b.get(a).value}function o(a,b,c){if(!b.has(a))throw new TypeError("attempted to set private field on non-instance");var d=b.get(a);if(!d.writable)throw new TypeError("attempted to set read only private field");return d.value=c,c}function p(a){if("function"==typeof a){for(var b=arguments.length,c=Array(1<b?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];a.apply(void 0,c)}}a=a&&a.hasOwnProperty("default")?a["default"]:a;var q=/*#__PURE__*/function(){function a(b){c(this,a);var d=b.articleId,e=b.dataSourceId,f=b.fields,g=b.groupBy,h=b.timeout;d?this.articleId=d:window.af&&window.af.article&&(this.articleId=window.af.article.id),this.dataSourceId=e||null,this.fields=f||null,this.groupBy=g||null,this.timeout=h||3e4}return e(a,[{key:"create",value:function(a,b){return this.request("create",a,b)}},{key:"destroy",value:function(a,b){return this.request("destroy",a,b)}},{key:"retrieve",value:function(a,b){return this.request("retrieve",a,b)}},{key:"update",value:function(a,b){return this.request("update",a,b)}},{key:"request",value:function(a,b,c){var d=this;return new Promise(function(e,f){var g={body:JSON.stringify(b),method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"}},h=null,i="/".concat(a,"/").concat(d.articleId,"/").concat(d.dataSourceId),j=!1;d.fields&&(i+="/".concat(d.fields instanceof Array?d.fields.join("-"):d.fields)),d.groupBy&&(i+="/"+d.groupBy),window.AbortController&&(d.previousRequestController&&d.previousRequestController.abort(),h=new window.AbortController,d.previousRequestController=h,g.signal=d.previousRequestController.signal);var k=setTimeout(function(){h&&h.abort(),j=!0,e(!1)},d.timeout);fetch(i,g).then(function(a){return clearTimeout(k),!(j||h&&d.previousRequestController!==h)&&a.json()}).then(function(a){!1===a?e(!1):a.hasOwnProperty("success")?(p(c,null,a.success),e(a.success)):a.hasOwnProperty("error")&&(p(c,null,a.error),f(a.error))}).catch(function(a){"Aborted"===a.message||window.AbortError&&a instanceof window.AbortError?e(!1):f(a)})})}}]),a}(),r=/*#__PURE__*/function(){function a(){c(this,a),f(this,"data",[])}return e(a,[{key:"create",value:function(a){if("object"!==b(a))throw new TypeError("Record must be an object");return this.data.push(a)-1}},{key:"destroy",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;if(null!==this.getRecord())return this.data.splice(a,1),!0;throw new Error("No record found for index ".concat(a))}},{key:"getRecord",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return this.data[a]||null}},{key:"length",value:function(){return this.data.length}},{key:"retrieve",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;return"number"!=typeof a||isNaN(a)?this.data:this.getRecorddata[a]||null}},{key:"update",value:function(a,b){var c=this.getRecord(a);if(c)this.data[a]=b instanceof Array?b:Object.assign({},this.data[a],b);else throw new Error("No record found for index ".concat(a));return!0}}]),a}(),s={dataHandler:null,articleId:window.af&&window.af.article&&window.af.article.id,dataSourceId:null,timeout:3e4,errorHandler:function(a,b){window.alert(a),p(b,a,null)},linkFields:null,disableAutoload:!1,dynamicLoading:!1,allowDelete:!1,allowUpdate:!1,allowInsert:!1,strict:!1,selectFirstRow:!0,optimisticLocking:!1,hasIITrig:!1,hasIUTrig:!1,hasIDTrig:!1,parameters:{filterString:"",whereClause:"",filterObject:null,whereObject:null,sortOrder:[],maxRecords:-1,distinctRows:!1,masterChildCriteria:{}},systemFieldNames:{},masterDataObject:null,groupBy:null,uniqueIdField:"PrimKey",fields:[]},t=/*#__PURE__*/function(a){function b(a){var d;return c(this,b),d=k(this,h(b).call(this)),u.set(j(j(d)),{writable:!0,value:void 0}),v.set(j(j(d)),{writable:!0,value:new r}),w.set(j(j(d)),{writable:!0,value:void 0}),x.set(j(j(d)),{writable:!0,value:[]}),y.set(j(j(d)),{writable:!0,value:!1}),z.set(j(j(d)),{writable:!0,value:null}),A.set(j(j(d)),{writable:!0,value:{}}),B.set(j(j(d)),{writable:!0,value:{}}),C.set(j(j(d)),{writable:!0,value:{}}),D.set(j(j(d)),{writable:!0,value:{}}),E.set(j(j(d)),{writable:!0,value:null}),F.set(j(j(d)),{writable:!0,value:!1}),G.set(j(j(d)),{writable:!0,value:!1}),H.set(j(j(d)),{writable:!0,value:!1}),I.set(j(j(d)),{writable:!0,value:!1}),J.set(j(j(d)),{writable:!0,value:!1}),o(j(j(d)),w,Object.assign({},s,a)),a.parameters&&(n(j(j(d)),w).parameters=Object.assign({},s.parameters,a.parameters)),o(j(j(d)),u,a.dataHandler||new q({articleId:a.articleId,dataSourceId:a.dataSourceId,timeout:a.timeout})),delete n(j(j(d)),w).dataHandler,delete n(j(j(d)),w).storageEngine,d.initialize(),d}return g(b,a),e(b,[{key:"attachEvent",value:function(a,c){m(h(b.prototype),"on",this).call(this,a,c)}},{key:"detachEvent",value:function(a,c){m(h(b.prototype),"removeListener",this).call(this,a,c)}},{key:"cancelEdit",value:function(){}},{key:"cancelField",value:function(){}},{key:"currentRow",value:function(){}},{key:"endEdit",value:function(){}},{key:"deleteCurrentRow",value:function(){return new Promise(function(){})}},{key:"deleteRow",value:function(){return new Promise(function(){})}},{key:"initialize",value:function(){var a=this;this.fields||this.getFieldsAsync().then(function(b){a.fields=b,a.initialize=null}),this.initialize=function(){console.warn("Data object ".concat(this.dataSourceId," has already been initialized."))}}},{key:"isDataLoaded",value:function(){}},{key:"isDataLoading",value:function(){}},{key:"isDeleteAllowed",value:function(){}},{key:"isUpdateAllowed",value:function(){}},{key:"isInsertAllowed",value:function(){}},{key:"isDeleteNeverAllowed",value:function(){}},{key:"isUpdateNeverAllowed",value:function(){}},{key:"isInsertNeverAllowed",value:function(){}},{key:"getCurrentIndex",value:function(){}},{key:"getData",value:function(){}},{key:"getDataLength",value:function(){}},{key:"getDataSourceId",value:function(){}},{key:"getFields",value:function(){}},{key:"getFieldsAsync",value:function(){}},{key:"getMasterDataObject",value:function(){return n(this,w).masterDataObject}},{key:"getParameter",value:function(a){return n(this,w).parameters[a]||null}},{key:"refreshCurrentRow",value:function(){return new Promise(function(){})}},{key:"refreshDataSource",value:function(){return new Promise(function(){})}},{key:"refreshRow",value:function(){return new Promise(function(){})}},{key:"setAllowDelete",value:function(){}},{key:"setAllowUpdate",value:function(){}},{key:"setAllowInsert",value:function(){}},{key:"setParameter",value:function(a,b){var c=["filterString","whereClause"].includes(a);if(n(this,w).strict&&c)throw new Error("Setting ".concat(a," is not allowed when dataObject is in strict mode"));c&&(!b&&(b=""),this.setParameter("filterString"===a?"filterObject":"whereObject",null));var d=n(this,w).parameters[a];d!==b&&(n(this,w).parameters[a]=b,this.emit("onParameterUpdated",a))}}]),b}(a),u=new WeakMap,v=new WeakMap,w=new WeakMap,x=new WeakMap,y=new WeakMap,z=new WeakMap,A=new WeakMap,B=new WeakMap,C=new WeakMap,D=new WeakMap,E=new WeakMap,F=new WeakMap,G=new WeakMap,H=new WeakMap,I=new WeakMap,J=new WeakMap;return t});
